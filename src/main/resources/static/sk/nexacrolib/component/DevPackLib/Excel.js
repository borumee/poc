var pForm=nexacro.Form.prototype;pForm.gfnExcelExport=function(_a,_b,_c,_d,_e,_f,_g,_h){if(this.gfnIsNull(_g)){_g=true;}var _i=/[?*:\/\[\]]/g;if(_a instanceof Array){if(_a.length!=_b.length){alert("Grid와 Sheet명의 갯수가 다릅니다.");return;}if(this.gfnIsNull(_e)){_e=new Array(_a.length);}else{if(this.gfnIsString(_e)||_a.length!=_e.length){alert("Grid와 삭제할 칼럼의 갯수가 다릅니다. 배열로 지정해 주세요.");return;}}if(this.gfnIsNull(_f)){_f=new Array(_a.length);}else{if(this.gfnIsString(_f)||_a.length!=_f.length){alert("Grid와 Title의 갯수가 다릅니다. 배열로 지정해 주세요.");return;}}if(this.gfnIsNull(_h)){_h=new Array(_a.length);}else{if(this.gfnIsString(_h)||_a.length!=_h.length){alert("Grid와 단위의 갯수가 다릅니다. 배열로 지정해 주세요.");return;}}var _j=new Array();for(var _o=0;_o<_b.length;_o++ ){_b[_o]=_b[_o].replace(_i,"");if(String(_b[_o]).length>30){_b[_o]="sheet"+_o;}if(_b[_o].indexOf("!")==-1){_j[_o]=_b[_o]+"!A1";}else{_j[_o]=_b[_o];}}}else{if(!(_a instanceof Grid)){alert("Export 대상 Grid를 지정하세요.");return;}_b=_b.replace(_i,"");_b=this.gfnIsNull(_b)?"sheet1":_b;if(String(_b).length>30){_b="sheet1";}if(_b.indexOf("!")==-1){_b=_b+"!A1";}}_c=_c.replace(_i,"");_c=this.gfnIsNull(_c)?this.titletext+"_"+this.gfnGetDate():_c;var _k=new nexacro.ExcelExportObject();_k.set_exportfilename(_c);if(this.gfnIsNull(_d)){_d="EXCEL97";}var _l;switch(_d){case "EXCEL":_l=nexacro.ExportTypes.EXCEL;break;case "EXCEL97":_l=nexacro.ExportTypes.EXCEL97;break;case "EXCEL2007":_l=nexacro.ExportTypes.EXCEL2007;break;case "HANCELL2010":_l=nexacro.ExportTypes.HANCELL2010;break;case "HANCELL2014":_l=nexacro.ExportTypes.HANCELL2014;break;case "CSV":_l=nexacro.ExportTypes.CSV;break;}_k.set_exporttype(_l);_k.set_exporteventtype("itemrecord");_k.set_exportuitype("none");_k.set_exportwordwrap(_g);_k.set_exportmessageprocess("");_k.addEventHandler("onsuccess",this.gfnExportOnsuccess,this);_k.addEventHandler("onerror",this.gfnExportOnerror,this);this.uCopyGrid=[];this.uGridName=""+_a.name;if(_a instanceof Array){var _m=[];for(var _o=0;_o<_a.length;_o++ ){if(this.gfnIsNull(_e[_o])==false||this.gfnIsNull(_f[_o])==false||this.gfnIsNull(_h[_o])==false){_m[_o]=this._gfnExportGrid(_a[_o],_e[_o],_f[_o],_h[_o]);this.uCopyGrid.push(_m[_o]);}else{_m[_o]=_a[_o];}_k.addExportItem(nexacro.ExportItemTypes.GRID,_m[_o],_j[_o],"allband","allrecord");}}else{if(this.gfnIsNull(_e)==false||this.gfnIsNull(_f)==false||this.gfnIsNull(_h)==false){var _m=this._gfnExportGrid(_a,_e,_f,_h);this.uCopyGrid.push(_m);_k.addExportItem(nexacro.ExportItemTypes.GRID,_m,_b,"allband","allrecord");}else{_k.addExportItem(nexacro.ExportItemTypes.GRID,_a,_b,"allband","allrecord");}}var _n="svcUrl::XExportImport.do";_k.set_exporturl(_n);this.setWaitCursor(true);_k.exportData();};pForm._gfnExportGrid=function(_a,_b,_c,_d){var _e=_a.name+"_Excel";if(!this[_e]){var _f=new Grid(_e,0,0,0,0,null,null);this.addChild(_e,_f);_f.show();}else{var _f=this[_e];}_f.set_formats(_a.getCurFormatString(false));_f.set_formatid(_a.formatid);_f.set_binddataset(_a.binddataset);_f.set_summarytype(_a.summarytype);_f.set_autofittype(_a.autofittype);_f.set_visible(false);var _g=_f.getCellCount("head");if(this.gfnIsNull(_b)==false){arrColumn=_b.split(",");for(var _m=arrColumn.length-1;_m>=0;_m-- ){_f.deleteContentsCol("body",nexacro.trim(arrColumn[_m]));}_g=_f.getCellCount("head");}if(this.gfnIsNull(_c)==false){var _h=_f.getFormatColCount();for(var _n=0;_n<=_h;_n++ ){_f.setFormatColProperty(_n,"band","body");}var _i=_f.insertContentsRow("head",0);var _j=_f.mergeContentsCell("head",0,0,0,_h -1,0,false);_f.setCellProperty("head",_j,"text",_c);var _k=_f.insertContentsRow("head",1);var _l=_f.mergeContentsCell("head",1,0,1,_h -1,1,false);if(this.gfnIsNull(_d)==false){_f.setCellProperty("head",_l,"text",_d);_f.setCellProperty("head",_l,"color","#000000");_f.setCellProperty("head",_l,"font","normal 12px/normal Dotum");_f.setCellProperty("head",_l,"textAlign","left");}_f.setCellProperty("head",_l,"background","#ffffff");}else{if(this.gfnIsNull(_d)==false){var _h=_f.getFormatColCount();for(var _n=0;_n<=_h;_n++ ){_f.setFormatColProperty(_n,"band","body");}var _i=_f.insertContentsRow("head",0);var _j=_f.mergeContentsCell("head",0,0,0,_h -1,0,false);_f.setCellProperty("head",_j,"text",_d);_f.setCellProperty("head",_j,"color","#000000");_f.setCellProperty("head",_j,"font","normal 12px/normal Dotum");_f.setCellProperty("head",_j,"textAlign","left");_f.setCellProperty("head",_j,"background","#ffffff");}}return _f;};pForm.gfnExportOnsuccess=function(_a,_b){this.setWaitCursor(false);var _c=this.uCopyGrid;for(var _e=0;_e<_c.length;_e++ ){var _a=this.removeChild(_c[_e].name);_a.destroy();_a=null;}this.uCopyGrid=null;var _d="fnExcellExportCallback";if(this.name=="commonExcel"){if(this.parent.parent[_d]){this.parent.parent.lookupFunc(_d).call(this.uGridName,_b);}}else{if(this[_d]){this.lookupFunc(_d).call(this.uGridName,_b);}}this.uGridName=null;};pForm.gfnExportOnerror=function(_a,_b){this.setWaitCursor(false);var _c=this.uCopyGrid;for(var _d=0;_d<_c.length;_d++ ){var _a=this.removeChild(_c[_d].name);_a.destroy();_a=null;}this.uCopyGrid=null;this.gfnAlert("msg.err.validator",[_b.errormsg]);};pForm.gfnExcelImport=function(_a,_b,_c,_d,_e,_f,_g,_h){if(this.gfnIsNull(_b)){_b="sheet1";}if(this.gfnIsNull(_c)){_c="A2";}if(_a instanceof Array){if(_a.length!=_b.length){alert("Dataset과 Sheet명의 갯수가 다릅니다.");return;}if(_a.length!=_c.length){alert("Dataset과 Import Body 영역의 갯수가 다릅니다.");return;}}var _i;if(this.gfnIsNull(this.objects[_e+"_ExcelImport"])){_i=new nexacro.ExcelImportObject(_e+"_ExcelImport",this);this.addChild(_e+"_ExcelImport",_i);}else{_i=this.objects[_e+"_ExcelImport"];}_i.outds=_a;_i.uGrid=_h;if(this.gfnIsNull(_f)){_f="EXCEL97";}var _j;switch(_f){case "EXCEL":_j=nexacro.ImportTypes.EXCEL;break;case "EXCEL97":_j=nexacro.ImportTypes.EXCEL97;break;case "EXCEL2007":_j=nexacro.ImportTypes.EXCEL2007;break;case "HANCELL2010":_j=nexacro.ImportTypes.EXCEL2007;break;case "HANCELL2014":_j=nexacro.ImportTypes.HANCELL2014;break;case "CSV":_j=nexacro.ImportTypes.CSV;break;}_i.set_importtype(_j);_i.set_filefilter("Excel Files(*.xlsx)|*.xls;*.xlsx");if(!this.gfnIsNull(_d)){_i.callback=_d;_i.importid=_e;}_i.addEventHandler("onsuccess",this.gfnImportOnsuccess,this);_i.addEventHandler("onerror",this.gfnImportOnerror,this);if(_a instanceof Array){var _k="";var _l="[";for(var _q=0;_q<_a.length;_q++ ){var _m=_a[_q]+"_outds";if(this.isValidObject(_m)){var _n=this.removeChild(_m);_n.destroy();_n=null;}var _o=new Dataset();_o.name=_m;this.addChild(_o.name,_o);if(this.gfnIsNull(_g)){_k+="[command=getsheetdata;output=outDs"+_q+";body="+_b[_q]+"!"+_c[_q]+"]";}else{_k+="[command=getsheetdata;output=outDs"+_q+";head="+_b[_q]+"!"+_g[_q]+";body="+_b[_q]+"!"+_c[_q]+"]";}if(_q==0){_l+=(_m+"=outDs"+_q);}else{_l+=(", "+_m+"=outDs"+_q);}}_l+="]";}else{var _m=_a+"_outds";if(this.isValidObject(_m)){var _n=this.removeChild(_m);_n.destroy();_n=null;}var _o=new Dataset();_o.name=_m;this.addChild(_o.name,_o);if(this.gfnIsNull(_g)){var _k="[command=getsheetdata;output=outDs;body="+_b+"!"+_c+"]";}else{var _k="[command=getsheetdata;output=outDs;head="+_b+"!"+_g+";body="+_b+"!"+_c+"]";}var _l="["+_m+"=outDs]";}var _p="svcUrl::XExportImport.do";_i.set_importurl(_p);this.setWaitCursor(true);_i.importData("",_k,_l);trace("sParam : "+_k+" sParam2 : "+_l);this.setWaitCursor(false);};pForm.gfnImportOnsuccess=function(_a,_b){this.setWaitCursor(false);var _c=_a.callback;var _d=_a.importid;var _e=_a.outds;var _f=_a.uGrid;var _g=null;var _h=null;var _i="";if(_e instanceof Array){for(var _n=0;_n<_e.length;_n++ ){_g=this.objects[_e[_n]];_h=this.objects[_e[_n]+"_outds"];_g.set_enableevent(false);_i="";for(var _o=0;_o<_g.getColCount();_o++ ){_i="Column"+_o;if(_i!=_g.getColID(_o)){_h.updateColID(_i,_g.getColID(_o));}}for(var _p=0;_p<_h.getRowCount();_p++ ){var _j=_g.addRow();_g.copyRow(_j,_h,_p);}_g.set_enableevent(true);}}else{_g=this.objects[_e];_h=this.objects[_e+"_outds"];_g.set_enableevent(false);_i="";var _k="";var _l=-1;var _m="";var _j=-1;_g.clearData();for(var _o=0;_o<_h.getRowCount();_o++ ){var _j=_g.addRow();_g.copyRow(_j,_h,_j);}_g.set_enableevent(true);}if(!this.gfnIsNull(_c)){if(this[_c]){this.lookupFunc(_c).call(_d,_b);}}};pForm.gfnImportOnerror=function(_a,_b){this.setWaitCursor(false);this.gfnAlert("msg.err.validator",[_b.errormsg]);};pForm=null;