var pForm=nexacro.Form.prototype;pForm.useErrorClass=true;pForm.gfnClearValidation=function(_a){_a.validationRuleSet="";if(this.useErrorClass){this.gfnResetValidationCss(_a);}};pForm.gfnRemoveValidation=function(_a,_b){var _c=new Array();if(!this.gfnIsNull(_a.validationRuleSet)){validObj=JSON.parse(_a.validationRuleSet);for(var _e in validObj){var _d=validObj[_e];if(_d.name!=_b){_c.push(_d);}}}_a.validationRuleSet=JSON.stringify(_c);};pForm.gfnSetValidation=function(_a,_b,_c,_d){var _e=new Array();if(_c.indexOf(",")!=-1){_c=nexacro.replaceAll(_c,",","^_^");}if(!this.gfnIsNull(_a.validationRuleSet)){_e=JSON.parse(_a.validationRuleSet);for(var _g in _e){if(_e[_g].name==_b){_e[_g].title=_c;_e[_g].value=_d;if(""+_d.indexOf("required")>-1){_e[_g].notnull=true;}else{_e[_g].notnull=false;}_a.validationRuleSet=JSON.stringify(_e);return true;}}}var _f={name:_b,title:_c,value:_d};if(""+_d.indexOf("required")>-1){_f.notnull=true;}else{_f.notnull=false;}_e.push(_f);_a.validationRuleSet=JSON.stringify(_e);};pForm.gfnValidation=function(_a,_b){var _c;var _d="";var _e="U";if(_a instanceof Dataset){_c=_a;_d="dataset";}else if(_a instanceof Grid){_c=_a.getBindDataset();_d="grid";}else{alert("Validation Check 대상에는 Dataset or Grid만 됩니다.");return false;}if(_b=="A"||_b=="U"){_e=_b;}else{if(this.gfnTypeOf(_b)=="number"){_e="Row";}else{alert("Validation Check대상의 Row는 'U' or 'A' or Dataset의 row만 됩니다.");return false;}}var _f=new Array();if(!this.gfnIsNull(_c.validationRuleSet)){_f=JSON.parse(_c.validationRuleSet);}else{alert("Validation Check RuleSet이 없습니다.");return false;}var _g=0;if(_e=="Row"){ ++_g;for(var _s=0;_s<_f.length;_s++ ){var _h=_f[_s].name;var _i=new String(_f[_s].title);var _j=_c.getColumn(_b,_h);var _k=(""+_f[_s].value).split(",");var _l=_f[_s].notnull;if(_l==true){if(this.gfnIsNull(_j)){_c.set_rowposition(_b);this.validationObject=_a;this.validationColumn=_h;var _m="";if(_i.indexOf("^_^")!=-1){_m=_i.split("^_^")[0];}else{_m=_i;}this.gfnAlert("msg.err.validator.required",[_m],null,"gfnValidationCallback");return false;}}if(!this.gfnIsNull(_j)){for(var _t=0;_t<_k.length;_t++ ){var _n="";var _o=_k[_t].split(":")[0];if(_o=="fromto"||_o=="fromtosmall"||_o=="comparebig"||_o=="comparesmall"||_o=="compareequal"){var _p;var _q;if(_k[_t].split(":").length==3){_p=_c.getColumn(_b,_k[_t].split(":")[1]);_q=_c.getColumn(_b,_k[_t].split(":")[2]);}else{_p=_c.getColumn(_b,_h);_q=_c.getColumn(_b,_k[_t].split(":")[1]);}_n=this.gfnValidationCheckRule(_i,_j,_k[_t],_p,_q);}else{_n=this.gfnValidationCheckRule(_i,_j,_k[_t]);}if(!this.gfnIsNull(_n)){_c.set_rowposition(_b);this.validationObject=_a;this.validationColumn=_h;this.gfnAlert("msg.err.validator",[_n],null,"gfnValidationCallback");return false;}}}}}else{for(var _u=0;_u<_c.getRowCount();_u++ ){var _r=_c.getRowType(_u);if(_e=="U"){if(_r==1){continue;}else if(_r==8){continue;}else if(_r==16){continue;}if(_r==2||_r==4){ ++_g;}}else{if(_r==16){continue;}++ _g;}for(var _s=0;_s<_f.length;_s++ ){var _h=_f[_s].name;var _i=new String(_f[_s].title);var _j=_c.getColumn(_u,_h);var _k=(""+_f[_s].value).split(",");var _l=_f[_s].notnull;if(_l==true){if(this.gfnIsNull((""+_j).trim())){_c.set_rowposition(_u);this.validationObject=_a;this.validationColumn=_h;var _m="";if(_i.indexOf("^_^")!=-1){_m=_i.split("^_^")[0];}else{_m=_i;}this.gfnAlert("msg.err.validator.required",[_m],null,"gfnValidationCallback");return false;}}if(!this.gfnIsNull(_j)){for(var _t=0;_t<_k.length;_t++ ){var _n="";var _o=_k[_t].split(":")[0];if(_o=="fromto"||_o=="fromtosmall"||_o=="comparebig"||_o=="comparesmall"||_o=="compareequal"){var _p;var _q;if(_k[_t].split(":").length==3){_p=_c.getColumn(_u,_k[_t].split(":")[1]);_q=_c.getColumn(_u,_k[_t].split(":")[2]);}else{_p=_c.getColumn(_u,_h);_q=_c.getColumn(_u,_k[_t].split(":")[1]);}_n=this.gfnValidationCheckRule(_i,_j,_k[_t],_p,_q);}else{_n=this.gfnValidationCheckRule(_i,_j,_k[_t]);}if(!this.gfnIsNull(_n)){_c.set_rowposition(_u);this.validationObject=_a;this.validationColumn=_h;this.gfnAlert("msg.err.validator",[_n],"","gfnValidationCallback");return false;}}}}}}if(this.useErrorClass){this.gfnResetValidationCss(_a);}if(_g==0){trace("정합성 체크 대상이 없어 Validation 체크를 하지 않았습니다.");}return true;};pForm.gfnValidationCheckRule=function(_a,_b,_c,_d,_e){var _f="";var _g="";var _h="";if(_a.indexOf("^_^")!=-1){_f=_a.split("^_^")[0];_g=_a.split("^_^")[0];_h=_a.split("^_^")[1];}else{_f=_a;}var _i=_c.split(":");var _j=_i[0];_j=_j.toLowerCase();switch(_j){case "length":if((_b+"").length!=parseInt(_i[1])){return this.gfnGetMessage("msg.err.validator.length",[_f,_i[1]]);}break;case "max":if(parseFloat(_b)>parseFloat(_i[1])){return this.gfnGetMessage("msg.err.validator.sizemax",[_f,_i[1]]);}break;case "min":if(parseFloat(_b)<parseFloat(_i[1])){return this.gfnGetMessage("msg.err.validator.sizemin",[_f,_i[1]]);}break;case "maxlength":if(_b.toString().length>parseInt(_i[1])){return this.gfnGetMessage("msg.err.validator.maxlength",[_f,_i[1]]);}break;case "maxlengthbyte":if(this.lookupFunc("gfnLengthByte").call(_b)>parseInt(_i[1])){return this.gfnGetMessage("msg.err.validator.maxlengthB",[_f,_i[1]]);}break;case "maxlengthdec":var _k=_b.toString().split(".");if((_k[0].replace("-","")).length>parseInt(_i[1])){return this.gfnGetMessage("msg.err.validator.max",[_f+" 정수 자리수",_i[1]+"자리"]);}if(_k.length>1){if(_k[1].length>parseInt(_i[2])){return this.gfnGetMessage("msg.err.validator.max",[_f+" 소수 자리수",_i[2]+"자리"]);}}break;case "minlength":if(_b.length<parseInt(_i[1])){return this.gfnGetMessage("msg.err.validator.minlength",[_f,_i[1]]);}break;case "minlengthbyte":if(this.lookupFunc("gfnLengthByte").call(_b)<parseInt(_i[1])){return this.gfnGetMessage("msg.err.validator.minlengthB",[_f,_i[1]]);}break;case "fromto":if(_d<_e){if(_a.indexOf("^_^")>-1){return this.gfnGetMessage("msg.err.validator.fromtomax",[_g,_h]);}else{return this.gfnGetMessage("msg.err.validator.fromtomax",[_f,_e]);}}break;case "fromtosmall":if(_d>_e){if(_a.indexOf("^_^")>-1){return this.gfnGetMessage("msg.err.validator.fromtomin",[_g,_h]);}else{return this.gfnGetMessage("msg.err.validator.fromtomin",[_f,_e]);}}break;case "range":if(parseInt(_b)<parseInt(_i[1])||parseInt(_b)>parseInt(_i[2])){return this.gfnGetMessage("msg.err.validator.range",[_f,_i[1],_i[2]]);}break;case "isemail":if(!this.lookupFunc("gfnIsEmail").call(_b)){return this.gfnGetMessage("msg.err.validator.email",[_f]);}break;case "isssn":if(!this.lookupFunc("gfnIsSSN").call(_b)){return this.gfnGetMessage("msg.err.validator.ssn",[_f]);}break;case "isbzid":if(!this.lookupFunc("gfnIsBzIdNo").call(_b)){return this.gfnGetMessage("msg.err.validator.biznum",[_f]);}break;case "isfirmid":if(!this.lookupFunc("gfnIsFirmIdNo").call(_b)){return this.gfnGetMessage("msg.err.validator.bubin",[_f]);}break;case "date":if(!this.lookupFunc("gfnIsYMD").call(_b)){return this.gfnGetMessage("msg.err.validator.date",[_f]);}break;case "dateym":if(!this.lookupFunc("gfnIsYM").call(_b)){return this.gfnGetMessage("msg.err.validator.date",[_f]);}break;case "korean":if(!this.lookupFunc("gfnIsKoreanChar").call(_b)){return this.gfnGetMessage("msg.err.validator.hangle",[_f]);}break;case "digits":if(!this.lookupFunc("gfnIsDigit").call(_b)){return this.gfnGetMessage("msg.err.validator.digits",[_f]);}break;case "engnum":if(!this.lookupFunc("gfnIsEngNum").call(_b)){return this.gfnGetMessage("msg.err.validator.engnum",[_f]);}break;case "special":if(this.lookupFunc("gfnIsSpecialChar").call(_b)){return this.gfnGetMessage("msg.err.validator.notspecialchar",[_f]);}break;case "comparebig":if(parseFloat(_d)>parseFloat(_e)){if(_a.indexOf("^_^")!=-1){return this.gfnGetMessage("msg.err.validator.sizemax",[_g,_h]);}else{return this.gfnGetMessage("msg.err.validator.sizemax",[_f,_e]);}}break;case "comparesmall":if(parseFloat(_d)<parseFloat(_e)){if(_a.indexOf("^_^")!=-1){return this.gfnGetMessage("msg.err.validator.sizemin",[_g,_h]);}else{return this.gfnGetMessage("msg.err.validator.sizemin",[_f,_e]);}}break;case "compareequal":if(_d==_e){if(_a.indexOf("^_^")!=-1){return this.gfnGetMessage("msg.err.validator.notequalto",[_g,_h]);}else{return this.gfnGetMessage("msg.err.validator.notequalto",[_f,_e]);}}break;case "istel":if(!this.lookupFunc("gfnIsTelNum").call(_b)){return this.gfnGetMessage("msg.err.validator.tel",[_f]);}break;case "ismobile":if(!this.lookupFunc("gfnIsMobileNum").call(_b)){return this.gfnGetMessage("msg.err.validator.phone",[_f]);}break;case "isphone":if(!this.lookupFunc("gfnIsPhoneNum").call(_b)){return this.gfnGetMessage("msg.err.validator.phone",[_f]);}break;default:return "";break;}return "";};pForm.gfnValidationCallback=function(_a,_b){this.gfnSetValidationFocus(this.validationObject,this.validationColumn);};pForm.gfnSetValidationFocus=function(obj,bindcolumid){var binddataset;if(obj instanceof Grid){binddataset=obj.getBindDataset();}else{binddataset=obj;}if(obj instanceof Grid){obj.setCellPos(obj.getBindCellIndex("Body",bindcolumid));obj.showEditor(true);return;}else{if(!this.gfnIsNull(obj.bindgrid)){var gridobj=obj.bindgrid;gridobj.setCellPos(gridobj.getBindCellIndex("Body",bindcolumid));gridobj.showEditor(true);gridobj.setFocus();}}var targetFirstObj;var nCheckCnt=0;for(var j=0;j<this.binds.length;j++ ){if(eval("this."+this.binds[j].datasetid)==binddataset&&this.binds[j].columnid==bindcolumid){var targetobj=eval("this."+this.binds[j].compid);if(this.useErrorClass){var objtype=targetobj.valueOf();if(objtype=="[object Edit]"){targetobj.orgcssclass=targetobj.cssclass;targetobj.set_cssclass("error");}else if(objtype=="[object MaskEdit]"){targetobj.orgcssclass=targetobj.cssclass;targetobj.set_cssclass("error");}else if(objtype=="[object Combo]"){targetobj.orgcssclass=targetobj.cssclass;targetobj.set_cssclass("error");}else if(objtype=="[object Calendar]"){targetobj.orgcssclass=targetobj.cssclass;targetobj.set_cssclass("error");}else if(objtype=="[object TextArea]"){targetobj.orgcssclass=targetobj.cssclass;targetobj.set_cssclass("error");}else if(objtype=="[object Spin]"){targetobj.orgcssclass=targetobj.cssclass;targetobj.set_cssclass("error");}}if(nCheckCnt==0){targetFirstObj=targetobj;}nCheckCnt++ ;}}if(nCheckCnt>0){targetFirstObj.setFocus();return;}};pForm.gfnResetValidationCss=function(objVal){var dataset;if(objVal instanceof Dataset){dataset=objVal;}else if(objVal instanceof Grid){dataset=objVal.getBindDataset();}for(var j=0;j<this.binds.length;j++ ){var sBindDs=this.binds[j].datasetid;if(this.gfnIsNull(sBindDs)==true){continue;}if(eval("this."+this.binds[j].datasetid)==dataset){try{var targetobj=eval("this."+this.binds[j].compid);if(targetobj.cssclass.indexOf("error")!=-1){targetobj.set_cssclass(targetobj.orgcssclass);targetobj.orgcssclass="";}}catch(e){}}}};pForm.gfnChkDuplicateData=function(_a,_b,_c){if(this.gfnIsNull(_c)){_c=_a.rowposition;}var _d="";var _e=_b.split(",");for(var _g=0;_g<_e.length;_g++ ){_d+=_e[_g].trim()+" == '"+_a.getColumn(_c,_e[_g].trim())+"'";if(_g!=_e.length-1){_d+=" && ";}}var _f=_a.findRowExpr(_d);if(_f>-1){if(_f==_c){_f=_a.findRowExpr(_d,_c+1);}}return _f;};pForm=null;